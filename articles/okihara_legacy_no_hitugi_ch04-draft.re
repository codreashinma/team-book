= 第04章: バックアップの嘘

木曜の夜は眠れなかった。午前二時。門倉がコードを書いていた時間。目を閉じても、ターミナルの緑の文字が消えない。

金曜日。雨だった。

朝から細い雨が降り続いていた。オフィスビルの窓に灰色の空が貼りついている。入社から二週間が過ぎた。梅雨入りの発表は三日前。以来、太陽は一度も顔を出していない。

瀬川はターミナルを開き、本番サーバーにSSH接続した。目的はcronジョブの調査だ。@<tt>{_shadow_logs} に溜まり続けるデータは、どこかへ送出されている。テストで判明した @<tt>{bV} 関数はデータベースへの書き込みに過ぎない。その先がある。テーブルに書き込まれたデータを外部に運び出す何かが、必ず存在する。

//emlist[][bash]{
crontab -l | wc -l
//}

//emlist{
37
//}

三十七行。三十七個のcronジョブが登録されている。

椎名に社内チャットでメッセージを送った。「本番のcronジョブ一覧を持っていますか」。返信は三分後。添付ファイルが一つ。Confluenceに載っていた正規のジョブリストだった。ファイルを開く。二十三個。

三十七と二十三。差分は十四。

差分を抽出する。十四個のジョブのうち十三個はファイル名で推測がつく。@<tt>{batch_export_daily.sh}、@<tt>{cleanup_temp_tables.sh}、@<tt>{refresh_materialized_views.sh}——門倉が書いたバッチ処理。どれも @<tt>{/legacy/core/} のコードと連携する業務用スクリプト。ドキュメント記載はないが、動作は理解できる。

残りの一つ。

//emlist{
0 3 * * * /opt/bridgeflow/bin/sync_agent >> /dev/null 2>&1
//}

毎日午前三時に実行。出力は @<tt>{/dev/null} に捨てられている。ログは一切残らない。ジョブ名は @<tt>{sync_agent}。コメントは @<tt>{# sync} の一言だけ。

他の十三個には門倉のスクリプトらしい几帳面なコメントがある。処理内容、作成日、最終更新日。しかし @<tt>{sync_agent} にはそれがない。コメント一語。出力の完全な破棄。

バイナリのパスを確認した。

//emlist[][bash]{
file /opt/bridgeflow/bin/sync_agent
//}

//emlist{
/opt/bridgeflow/bin/sync_agent: ELF 64-bit LSB executable, x86-64, Go
//}

Goのコンパイル済みバイナリ。ソースコードを探す。GitHubリポジトリを検索した。

//emlist[][bash]{
grep -r "sync_agent" --include="*.go" .
//}

ゼロ件。リポジトリにソースがない。コンパイル済みのバイナリだけが本番サーバーの @<tt>{/opt/bridgeflow/bin/} に置かれている。ビルドスクリプトもMakefileも存在しない。

設定ファイルを探した。

//emlist[][bash]{
find /opt/bridgeflow/etc/ -name "*sync*"
//}

//emlist{
/opt/bridgeflow/etc/sync_agent.yaml
//}

//emlist[][bash]{
cat /opt/bridgeflow/etc/sync_agent.yaml
//}

画面にYAMLが表示された。

//emlist[][yaml]{
source:
  type: mysql
  table: _shadow_logs
  batch_size: 10000
  delete_after_send: false

transform:
  encryption: AES-256-GCM
  compress: true

destination:
  endpoint: https://collect.databridge-analytics.com/api/v2/ingest
  auth:
    type: client_certificate
    cert: /opt/bridgeflow/certs/client.pem
    key: /opt/bridgeflow/certs/client-key.pem

logging:
  level: "none"
//}

一行ずつ読む。

@<tt>{source}——@<tt>{_shadow_logs}。毎日午前三時。一万行ずつ。@<tt>{transform} でAES-256-GCM暗号化と圧縮。@<tt>{destination}——@<tt>{https://collect.databridge-analytics.com/api/v2/ingest}。ここへ送信。そして @<tt>{logging}。レベルは @<tt>{"none"}。何も記録しない設定だ。

@<tt>{_shadow_logs} のデータが、毎晩、暗号化されて外部のサーバーに送信されている。三万社のユーザーの全行動データが。毎日。午前三時に。

送信先のドメイン名を見つめた。@<tt>{databridge-analytics.com}。聞いたことのない名前だ。

認証にはクライアント証明書が使われている。証明書のパスが記されている。

//emlist[][bash]{
openssl x509 -in /opt/bridgeflow/certs/client.pem -noout -subject -issuer -email
//}

画面に出力が流れた。

//emlist{
subject=CN = collect.databridge-analytics.com
issuer=CN = DBAnalytics CA
email=ogino.takeshi@bridgeflow.co.jp
//}

三行目。

@<tt>{email=ogino.takeshi@bridgeflow.co.jp}

読み終えた目が、その行に戻る。もう一度。もう一度。

//emlist{
email=ogino.takeshi@bridgeflow.co.jp
//}

ogino.takeshi。荻野武。開発部長のメールアドレス。

この証明書の管理者は荻野だ。@<tt>{sync_agent} が毎晩データを送信する先のサーバーの証明書を、荻野が作成している。ソースコードがリポジトリにないバイナリ。ログを一切残さない設定。外部への暗号化送信。その全てを、開発部長の荻野武が管理している。

画面の文字が白くぼやけた。指が動かない。キーボードの上に置いた両手が冷たい。

背後で誰かのキーボードを叩く音。フロアの日常。空調の低い唸り。蛍光灯の微かなちらつき。窓の外は灰色。

//hr

月曜日。

土日の間、何度も同じ情報を頭の中で反芻した。証明書のメールアドレス。YAMLの設定ファイル。@<tt>{_shadow_logs}。@<tt>{sync_agent}。荻野。全ての線が一人の人間に収束する。月曜の朝を待つ二日間は長かった。

九時十五分。荻野のデスクに向かった。

荻野は席にいた。ノートPCの画面に何かの表計算ソフトが開いている。瀬川が近づくと、顔を上げて笑顔を見せた。いつもの穏やかな笑顔。恰幅の良い中年男性の余裕。

「おはよう、瀬川くん。何かあったかな」

「本番サーバーのcronジョブを調査しています」

嘘は言わなかった。事実を述べた。荻野の反応を見る。

「sync_agent というバイナリが登録されています。Confluenceの正規ジョブリストにはない。ソースコードもリポジトリにありません」

荻野の笑顔が消えた。一瞬——コンマ三秒。目の周りの筋肉が引き締まり、口角が下がった。すぐに笑顔が戻る。消えた瞬間を見逃すことはできなかった。

「ああ、sync_agent ね。分析用のデータ連携ツールだよ。門倉くんが設定したものだ」

穏やかな声。リラックスした姿勢。けれど左手の人差し指が、デスクの縁を一度だけ叩いた。

「門倉が設定したものですか」

「まあね。もう二年くらい前かな。社内の分析基盤にデータを送る仕組みだよ。動いてるものだからね。いつもの通り、触らなくていいよ」

「設定ファイルの送信先が外部ドメインになっています。databridge-analytics.com です」

荻野の笑顔が微動だにしなかった。その不動さが、逆に不自然だった。人間は情報を受け取ったとき、何らかの反応をする。眉が動くか、視線が揺れるか、姿勢が変わるか。荻野は何もしなかった。完璧に静止した笑顔。

「ああ、それは外部の分析サービスだよ。匿名化したメトリクスを送ってるだけだ。門倉くんがSaaS立ち上げ当時から使ってたサービスでね」

門倉が設定した。門倉が使っていた。TLS証明書の管理者メールアドレスは荻野のものなのに、門倉の名前だけが出てくる。

瀬川は何も言わなかった。荻野は笑顔のまま続けた。

「ところで瀬川くん。本番サーバーのcronジョブはインフラの椎名くんの管轄だよね。バックエンドエンジニアが調べる範囲じゃないと思うんだけど」

声のトーンは変わらない。穏やかな笑顔。だが言葉の意味は明確だった。

「余計なことに時間を使わないように。リソースは限られているからね」

同じ言葉。第一週に聞いた言葉と同じ構造だ。「動いてるから触るな」の変奏。今度は「余計なことに首を突っ込むな」。柔らかい語尾の中に、一本の線が引かれている。この線を越えるな、と。

「分かりました」

自席に戻った。背中に荻野の視線を感じた。席に着くまでの十五歩の間、肩甲骨の間がひりつくように熱かった。

//hr

月曜の夜。自宅。私用のラップトップを開いた。

荻野の説明を一つずつ検証する。「門倉が設定した」——TLS証明書の管理者メールアドレスは @<tt>{ogino.takeshi@bridgeflow.co.jp}。門倉ではない。嘘。

「匿名化したメトリクスを送っている」——@<tt>{sync_agent.yaml} の @<tt>{source} は @<tt>{_shadow_logs} テーブルを直接参照。あのテーブルには匿名化されていないユーザーIDが紐付いている。嘘。

「SaaS立ち上げ当時から使っていたサービス」——まだ反証がない。確認する方法はある。

@<tt>{databridge-analytics.com} のwhois情報を引いた。

//emlist{
Domain Name: databridge-analytics.com
Creation Date: 2019-08-14
Registrant Organization: DB Analytics LLC
//}

ドメイン登録日は二〇一九年八月十四日。門倉の入社は二〇二〇年四月。ドメインは門倉の入社より八ヶ月前に登録されている。門倉が設定したはずのデータ連携ツールの送信先が、門倉の入社前から存在していた。

BridgeFlowのGitリポジトリ上で、門倉の最初のコミットを確認した。

//emlist[][bash]{
git log --author="Kadokura" --reverse --format="%ai %s" | head -5
//}

//emlist{
2020-04-06 10:23 initial commit: setup development environment
2020-04-07 09:41 feat: implement user authentication module
2020-04-08 14:15 feat: add organization management API
2020-04-10 11:32 feat: implement task CRUD operations
2020-05-12 10:45 refactor: restructure internal package layout
//}

入社後の半年間は、正規の業務コードだ。正常なコミット時刻。正常なコミットメッセージ。そして @<tt>{/legacy/core/} への最初のコミットは——

//emlist[][bash]{
git log --author="Kadokura" --reverse --format="%ai %s" -- legacy/core/ | head -3
//}

//emlist{
2020-11-15 02:34 feat: add data collection pipeline for analytics
2020-11-18 02:51 feat: implement payload serialization
2020-11-25 03:12 refactor: restructure payload format
//}

二〇二〇年十一月。入社七ヶ月目。深夜二時三十四分。ここから @<tt>{/legacy/core/} への深夜コミットが始まる。

事実は明瞭だった。データの送信先ドメインは門倉の入社前から用意されていた。荻野はBridgeFlowの立ち上げ段階で、ユーザーデータの外部売却を計画していた。門倉はその計画の実行を命じられた開発者に過ぎない。

ラップトップの画面を見つめた。雨が窓を叩いている。アパートの薄い壁を通して、隣室の生活音が微かに聞こえる。

ラップトップを閉じても、三十七個のファイルが消えない。@<tt>{// DO NOT TOUCH - K}。コメントの末尾。スペースの数。ファイルごとに違う。三個。七個。一個。整形のばらつきか。それとも——門倉はコメントの中にも何かを仕込んでいたのか。

USBメモリの @<tt>{truth.enc} を思い出す。暗号鍵はまだ見つかっていない。門倉が残した手がかりは、三十七個のファイルの中に散らばっている。

//hr

水曜日。昼前。

エレベーターホールで三島彩を待った。経理部の昼休みは十二時からだ。三島がエレベーターの前に現れる時間帯を二日間観察して把握している。

十二時三分。エレベーターのドアが開いた。三島が一人で降りてくる。きちんとしたブラウスにベージュのカーディガン。髪はいつも通り一つに束ねられている。瀬川に気づいた瞬間、足が止まった。

「三島さん。少しお聞きしたいことがあります」

三島の目が瀬川を見た。先週、食堂の前で見たときと同じ反応が一瞬よぎった。門倉の後任を見る目。だがすぐに事務的な表情に変わる。

「何でしょうか」

「DBアナリティクス合同会社について、ご存知ですか」

三島の顔から色が消えた。比喩ではない。頬と唇から血の気が引いて、肌が白く変わるのが見えた。ファイルを胸元に抱える手が震えている。

「それは」

声が裏返った。エレベーターホールの反響する空間で、三島の声が高く不自然に響いた。

「それは——私にはお答えできません」

ファイルを抱える力が強くなった。指の関節が白い。

「荻野部長に直接お聞きください」

荻野の名前を出した瞬間、三島は半歩後退った。自分が言った言葉に追い詰められたかのように。目が泳いでいる。荻野の名前を盾にしているのではない。荻野の名前しか出せないのだ。

「三島さん」

「申し訳ありません。お昼の時間なので」

踵を返して食堂の方へ歩いていく。歩調は速い。ほとんど小走りだった。エレベーターホールに残されたのは、消毒液の匂いと、雨に湿った空気だけだった。

「知っていて話せない」——その反応が意味するもの。三島は荻野の不正を知っている。知っていて、口を閉ざすことを強いられている。

//hr

木曜日。

外山健一が来社した。今月三度目だ。入社二日目の金曜日に一度。先週の月曜日に二度目。椎名の記録では外山の来社頻度は本来四半期に一度。六月だけで三回は異常な頻度だった。

「いやあ、こんにちは。セキュリティは日々進化しますからね」

受付で外山の声が聞こえた。高価そうなスーツ。営業用の笑顔。がっちりした体格に、よく磨かれた革靴。荻野が出迎え、二人は並んでサーバールームへ向かった。荻野の笑顔と外山の笑顔が隣り合う光景は、取引先との和やかな応対にしか見えない。

椎名がサーバールームに同行した。インフラ担当として、外部のコンサルタントがサーバールームに入る際の立ち会いは正当な業務だ。

昼休み。会議室C。瀬川と椎名は向かい合って座った。椎名は缶コーヒーを開けもせずにテーブルに置いた。

「四十五分間、サーバーに一切触れなかった」

椎名の声は低く、抑揚がない。事実を報告する口調。

「ラックの前に立ったのは最初の二分だけだ。残りの四十三分間、スマートフォンでネットワーク構成図を撮影していた。それから自分のラップトップを取り出して、テザリングで外部にアクセスしている」

「テザリング」

「社内ネットワークを経由しない。自前の回線だ。何にアクセスしていたかは俺のログには残らない」

社内のファイアウォールを迂回するための手段だ。自分のモバイル回線を使えば、椎名のネットワーク監視を完全にすり抜けられる。

「過去三回の監査レポートを照合した」

椎名がラップトップを開いた。画面に三枚のPDFが並べて表示されている。瀬川は身を乗り出した。

三枚のレポート。日付が異なる。四月、五月、六月。それぞれA4で十二ページ。セキュリティ監査報告書と銘打たれたフォーマット。結論は三枚とも同じ――「重大なセキュリティ上の問題は検出されませんでした」。

「diff を取った」

椎名がターミナルに切り替えた。テキスト化した三枚のレポートの差分が表示される。

「日付以外、全部一致する。ヘッダーの監査実施日と報告日だけ差し替えて、本文は一文字も変えていない」

三回分の監査が、同一の文章のコピーだった。監査を実施していない。サーバーに触れもしない。四十五分間スマートフォンで写真を撮り、テザリングでどこかにアクセスする。それがセキュリティ監査の実態だった。

椎名が缶コーヒーのプルタブを引いた。金属の小さな音が会議室に響いた。

「半年前の話をする」

椎名の視線が缶コーヒーの表面に落ちた。口調は変わらない。だが文が、椎名にしては長い。

「去年の十一月。ネットワークトラフィック分析をやっていて、外向きの通信に異常を見つけた。毎晩午前三時、約二百メガバイトのアウトバウンドが発生している。送信先は @<tt>{databridge-analytics.com}」

瀬川の背筋が伸びた。同じドメイン名。@<tt>{sync_agent.yaml} に書かれていた送信先と同一。

「荻野に報告した」

「荻野に」

「上長だ。報告先としておかしくはないだろう」

椎名の声にわずかな苦味が混じった。

「荻野は『運用スクリプトの一部だ。問題ない』と言った。そのとき目を泳がせた。荻野が目を泳がせるのを見たのは、あれが初めてだ」

穏やかな笑顔を崩さない荻野。その笑顔の下で目が泳いだ。椎名はその一瞬を見逃さなかった。

「それから独自に監視を始めた。外山の来社日にVPN経由の異常アクセスが発生する。半年分のログを保全してある」

半年間。椎名は一人で監視を続けていた。ネットワークのログだけを頼りに、コードの中身を読めないまま、外側から異常を追い続けた。

「なぜ、もっと早く誰かに」

言いかけて止めた。答えは分かっている。コードの中に何があるかを読める人間が必要だった。ネットワークのログだけでは、何が送信されているのかを証明できない。荻野に報告しても握りつぶされる。他に誰に言えばいい。CTOの黒木か。だが黒木は一年以上コードを書いていない。

椎名が缶コーヒーを一口飲んだ。窓の外で雨が激しくなっている。会議室のガラス越しに、灰色の空がぼやけて見える。

「門倉が消えて——」

椎名が言葉を切った。普段なら文を完結させてから次に進む。今、文が途切れた。

「待っていた。次に来る人間を」

缶コーヒーをテーブルに置く音が、静かな会議室に響いた。

椎名の目が瀬川を見た。感情を表に出さない男の目に、半年分の何かがあった。怒りなのか。焦燥なのか。あるいは、ようやく来た、という確認なのか。

瀬川は黙って頷いた。言葉は要らなかった。

//hr

木曜の夜。自宅。

私用のラップトップで、外山の会社を調べた。

外山健一が代表を務める「外山セキュリティ・コンサルティング合同会社」。登記情報を検索する。本店所在地は港区南青山のレンタルオフィス。資本金百万円。社員数の記載なし。代表社員は外山健一のみ。合同会社の一人法人だ。

会社のウェブサイトを開いた。テンプレートで作られた簡素なページ。「セキュリティ診断」「脆弱性評価」「コンプライアンス支援」。文言はどこかのコンサルティング会社から借りてきたような汎用的な内容だ。実績として「大手SaaS企業への継続的セキュリティ監査」とあるが、具体的な社名は記載されていない。

DNSレコードを確認した。

//emlist[][bash]{
dig +short NS databridge-analytics.com
//}

//emlist{
ns1.valueserver.jp.
ns2.valueserver.jp.
//}

//emlist[][bash]{
dig +short NS toyama-security.co.jp
//}

//emlist{
ns1.valueserver.jp.
ns2.valueserver.jp.
//}

同じネームサーバー。@<tt>{databridge-analytics.com} と @<tt>{toyama-security.co.jp}。

偶然ではない。同じ人間。同じホスティングサービス。二つのドメイン。一つはデータの受信先。もう一つはセキュリティコンサルタントの看板。

荻野が @<tt>{_shadow_logs} にユーザーデータを蓄積させる。門倉にコードを書かせる。@<tt>{sync_agent} で毎晩暗号化して外部に送信。受け取るのは @<tt>{databridge-analytics.com}。同じネームサーバーを共有する外山セキュリティ・コンサルティング。外山はセキュリティ監査を装ってサーバールームに出入り。ネットワーク構成を把握。コピペの監査レポートで「問題なし」を出し続ける。監査はセキュリティを守るためではない。データ窃取のインフラを維持するためのカバーストーリー。

荻野と外山。社内の管理職と外部のコンサルタント。共犯構造。

ラップトップの画面を閉じた。部屋が暗くなった。雨音だけが残る。

//hr

ベッドに座ったまま、情報を並べていく。

@<tt>{_shadow_logs}。千二百万行。今も増え続けている。@<tt>{sync_agent} が毎晩午前三時に暗号化して送信。証明書に荻野のメール。荻野は嘘をついた。ドメインは門倉の入社前から存在。外山のドメインと同じネームサーバー。監査レポートは三回分がコピペ。三島はパニックになった。知っていて話せない。

荻野がデータ売却の首謀者。外山が受け取り側。門倉は強制された。三島も強制されている。

ところが黒木の立場が分からない。三年間コードを書いていない。瀬川を見つめる視線。敵か味方か。佐々木の正体も不明。入社二週間で社内事情に詳しすぎる。画面を覗いた視線の意図。データの最終的な買い手。外山の先にいるのは誰か。門倉の現在地。「もう戻れない」と書いて消えた男は、今どこにいるのか。

デスクの引き出しからUSBメモリを取り出した。「開けるな」のラベル。@<tt>{truth.enc}。暗号鍵はまだ見つかっていない。

門倉は四年間、荻野のためにコードを書かされた。深夜二時から四時。千四百六十日。だがその間に、三十七個のファイル全てに @<tt>{// DO NOT TOUCH - K} を刻み、コミットメッセージに「もう引き返せない」と書き、USBに何かを暗号化して残した。

暗号鍵は、三十七個のファイルの中にある。

確信があった。門倉は証拠を残すために四年間コードを書いた。見つけてくれる人間が来ることを信じて。椎名が半年間待ったように。門倉は四年間待った。

USBメモリをデスクに戻した。窓の外は雨だった。六月の夜。梅雨前線がこの街の上に居座って動かない。視界は閉ざされ、空は灰色で、日差しが戻る気配はなかった。

見えないものが見え始めていた。コードの中に隠された事実。ネットワークログが記録した異常。コピペされた監査レポート。顔から色を失った三島の表情。証明書に刻まれた荻野のメールアドレス。一つずつ、一つずつ、霧の中から輪郭が浮かび上がってくる。

黒木の立場が分からない。味方なら、状況は変わる。敵なら——瀬川と椎名は完全に孤立する。

雨音を聞きながら、天井を見上げた。

門倉のコミット時刻。午前三時。@<tt>{sync_agent} の実行時刻も午前三時。門倉がコードを書いていた時間に、そのコードが動く。毎晩、毎晩、四年間。

目を閉じる。暗闇の中に、ターミナルの緑の文字が浮かんで消える。

@<tt>{email=ogino.takeshi@bridgeflow.co.jp}

その一行が、もう消えない。
